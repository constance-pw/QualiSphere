<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>QualiSphere : US Align√©es, Tests Automatis√©s. La Tra√ßabilit√© de l'Exigence.</title>
    <!-- Test1 Git depuis VS Code -->
    <style>
        /* ========================================================== */
        /* BASE & TYPOGRAPHIE */
        /* ========================================================== */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #fcfcfc; 
            margin: 0; 
            padding: 30px; 
            color: #333; 
            font-weight: 300; 
        }
        h1, h3, h4, h5 { font-weight: 400; } 
        
        /* 1. QUALISPHERE BRANDING */
        .header h1 { 
            color: #6A1B9A; 
            border-bottom: 2px solid #D1C4E9; 
            padding-bottom: 10px; 
            margin-bottom: 15px; 
            font-size: 2.2em; 
            font-weight: 300;
        } 
        .header p { 
            color: #777; 
            font-style: italic; 
            font-size: 1em; 
            margin-top: 0; 
        }
        
        /* Menu de s√©lection des US */
        .us-selector-header { 
            background-color: #ffffff; 
            border-radius: 8px; 
            padding: 20px 30px; 
            margin-bottom: 40px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }
        .us-tabs-container { display: flex; gap: 15px; flex-wrap: wrap; }
        .us-tab { 
            padding: 15px 20px; 
            cursor: default; 
            border: 1px solid #eee; 
            background-color: #f7f7f7; 
            border-radius: 6px; 
            transition: all 0.2s; 
            flex-grow: 1; 
            min-width: 200px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.02); 
            font-weight: 400; 
        }
        .us-tab.active { 
            background-color: #6A1B9A; 
            color: white; 
            font-weight: 500; 
            border-color: #4527A0; 
            box-shadow: 0 0 10px rgba(106, 27, 154, 0.4); 
        }
        .us-id { font-size: 0.9em; opacity: 0.8; margin-bottom: 3px; font-weight: 300;}
        .us-tab.active .us-id { opacity: 1; }
        .us-title { font-size: 1em; line-height: 1.3; }
        .us-type { font-size: 0.85em; color: #888; margin-top: 5px; font-weight: 300; }
        .us-tab.active .us-type { color: #f0eaff; }


        /* ========================================================== */
        /* Conteneurs de Section Principaux */
        /* ========================================================== */
        .tool-section { 
            background-color: #ffffff; 
            border-radius: 8px; 
            padding: 30px; 
            margin-bottom: 40px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }

        /* BLOC 1: Statuts US Agile */
        #us-statuses-section {
            background-color: #F8F4FF; 
            border: 1px solid #E6E0F8; 
            border-left: 5px solid #6A1B9A; 
            border-radius: 8px; 
            padding: 20px 30px;
            margin-bottom: 40px;
        }
        #us-statuses-section h3 {
            color: #6A1B9A; 
            border-bottom: 2px solid #D1C4E9; 
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 300;
            margin-top: 0;
        }
        .us-status-list {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 0;
            margin: 0 0 15px 0;
            list-style: none;
        }
        .us-status-item {
            padding: 10px 20px;
            border-radius: 20px; 
            font-weight: 600;
            font-size: 0.9em;
            color: #fff;
            min-width: 90px;
            text-align: center;
            transition: all 0.2s ease-in-out;
            border: 2px solid transparent;
            opacity: 0.7;
            cursor: pointer; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .us-status-item:hover { opacity: 1; }
        .status-Refining { background-color: #FFC107; color: #333; }
        .status-ReadyToDev { background-color: #2196F3; } 
        .status-InDev { background-color: #9C27B0; } 
        .status-InTest { background-color: #00BCD4; } 
        .status-Done { background-color: #4CAF50; } 

        .us-status-item.active-status {
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: scale(1.05);
            border: 2px solid #fff;
            opacity: 1;
        }
        
        /* BLOC 2: AZURE DEVOPS */
        #azure-devops-main-section h3 { 
            color: #0078D4; 
            border-bottom: 2px solid #B3E5FC; 
            font-size: 1.8em; 
            font-weight: 300;
            padding-bottom: 12px; 
            margin-top: 0; 
        }
        #azure-devops-main-section {
            border-left: 5px solid #0078D4; 
            padding-left: 25px; 
        }

        .us-title-content-block {
             margin-top: 10px;
             margin-bottom: 15px;
             font-size: 1.2em;
             font-weight: 400;
             color: #333;
        }
        .us-title-content-block span { font-weight: 500; }
        
        .us-title-section h5, .us-description-section h5, .ca-section h5 { 
            color: #0078D4; 
            margin-top: 30px; 
            border-bottom: none; 
            padding-bottom: 0; 
            font-size: 1.2em;
            font-weight: 500;
        }

        .us-desc-box { 
            border: 1px solid #f0f0f0; 
            padding: 20px; 
            background-color: #FAFAFA; 
            margin-top: 15px; 
            border-left: 4px solid #0078D4; 
            border-radius: 4px; 
            font-size: 1em; 
            line-height: 1.6;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            font-weight: 300;
        }
        .ca-gherkin {
            border: 1px solid #f0f0f0; 
            padding: 20px; 
            background-color: #FAFAFA;
            margin-top: 15px; 
            border-left: 4px solid #0078D4; 
            border-radius: 4px; 
            font-size: 1em; 
            line-height: 1.6;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            font-weight: 300;
        }
        .ca-gherkin strong { font-weight: 500; }
        .ca-gherkin ul { margin-top: 10px; padding-left: 25px; }
        .ca-gherkin li { margin-bottom: 8px; }

        /* BLOCS D'INFORMATION QA */
        .qa-toggle-link {
            display: inline-flex; 
            align-items: center;
            margin: 15px 0 25px 0;
            padding: 10px 20px;
            cursor: pointer;
            color: #6A1B9A;
            background-color: #F8F4FF; 
            border: 1px solid #E6E0F8; 
            border-radius: 50px; 
            font-weight: 500;
        }
        .qa-toggle-link:hover { background-color: #EFE8FF; }
        .qa-toggle-link::before { content: '\25B6'; margin-right: 8px; font-size: 0.8em; vertical-align: middle; display: inline-block; transition: transform 0.2s; color: #6A1B9A; }
        .qa-toggle-link.qa-active::before { content: '\25BC'; }

        .qa-info-block {
            padding: 20px; 
            border-radius: 6px; 
            margin-top: 15px; 
            margin-bottom: 30px; 
            font-size: 0.95em;
            color: #555; 
            line-height: 1.5;
            font-weight: 300;
        }

        .qa-info-block.standard { 
            background-color: #F7F0FF; 
            border-left: 5px solid #9C27B0; 
            border: 1px solid #E6E0F8;
        } 
        .qa-info-block.standard h5 { 
            font-size: 1.1em; 
            color: #6A1B9A; 
            font-weight: 500;
        }

        .qa-info-block.status-refining { background-color: #FFFCE8; border-left: 5px solid #FFC107; border: 1px solid #F8E9C4; }
        .qa-info-block.status-readytodev { background-color: #E3F2FD; border-left: 5px solid #2196F3; border: 1px solid #BBDEFB; }
        .qa-info-block.status-indev { background-color: #F3E5F5; border-left: 5px solid #9C27B0; border: 1px solid #E1BEE7; }
        .qa-info-block.status-intest { background-color: #E0F7FA; border-left: 5px solid #00BCD4; border: 1px solid #B2EBF2; }
        .qa-info-block.status-done { background-color: #E8FDE8; border-left: 5px solid #4CAF50; border: 1px solid #D4EADD; }
        
        .qa-info-block strong { font-weight: 600; color: #333; }
        .qa-info-block ul { padding-left: 20px; margin-top: 10px; list-style: circle;}
        .qa-info-block li { margin-bottom: 5px; }
        
        /* ========================================================== */
        /* 4. CERBERUS LOOK (Test Technique) */
        /* ========================================================== */
        
        /* COULEURS CUSTOM D√âFINIES PAR L'UTILISATEUR */
        /* BORDURES (D√©finition du type d'√©l√©ment - Reste en mode RUN) */
        :root {
            --color-step-border: rgb(39, 188, 253); /* Steps Gherkin */
            --color-action-border: rgb(44, 123, 229); /* Actions */
            --color-control-border: rgb(0, 210, 122); /* Contr√¥les */
        }
        
        /* FONDS D'EX√âCUTION (D√©fini par le statut - Utilis√© uniquement en mode RUN) */
        .BG_RUN_OK { background-color: rgb(224, 250, 239) !important; }
        .BG_RUN_KO { background-color: rgb(252, 231, 235) !important; } /* KO (Bug Dev) */
        .BG_RUN_FA { background-color: rgb(254, 240, 232) !important; } /* FA (Bug Auto) */
        
        /* TITRE DE SECTION CERBERUS */
        .cerberus-section h3 { 
            color: var(--color-action-border); /* Utilisation d'une couleur d'Action pour le titre */
            border-bottom: 2px solid #B3E5FC; 
            padding-bottom: 12px; 
            font-size: 1.8em; 
            font-weight: 300;
        }

        /* PROPRI√âT√âS CERBERUS */
        .cerberus-properties-box {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #E3F2FD;
            border: 1px solid #BBDEFB;
            border-left: 5px solid var(--color-action-border); 
            border-radius: 6px;
        }
        .cerberus-properties-box h4 {
            color: var(--color-action-border); 
            border-bottom: 1px dashed #BBDEFB;
            padding-bottom: 8px;
            font-size: 1.2em;
            font-weight: 500;
        }
        .property-item {
            display: inline-block;
            padding: 6px 12px;
            margin-right: 12px;
            margin-bottom: 8px;
            border: 1px solid #BBDEFB;
            background-color: #ffffff;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: 400;
        }
        .property-item strong { font-weight: 500; color: #333; }

        /* Vues Cerberus */
        .cerberus-view-wrapper { background-color: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .cerberus-editor-run { 
            display: flex; 
            border: 1px solid #eee; 
            border-radius: 6px; 
            min-height: 50vh; 
            margin-top: 15px; 
            background-color: #ffffff; 
            overflow: hidden;
        }
        .steps-container { width: 40%; border-right: 1px solid #eee; padding: 20px; }
        .actions-container { width: 60%; padding: 20px; }

        /* -- MODE √âDITION (ReadyToDev, InDev) -- */
        .step-block { 
            border: 1px solid #f0f0f0; 
            border-left: 4px solid var(--color-step-border); /* BORDURE STEP (Bleu Cyan) */
            border-radius: 4px; 
            padding: 15px; 
            margin-bottom: 15px; 
            cursor: pointer; 
            background-color: #fff; /* Fond Blanc */
            box-shadow: 0 0 5px rgba(0,0,0,0.05); 
            transition: all 0.1s;
        }
        .step-block:hover { background-color: #F8FDFF; } /* Petit hover light */
        .step-block.active { 
            border: 1px solid var(--color-step-border); /* Bordure compl√®te pour le step actif */
            border-left: 5px solid var(--color-step-border); 
            background-color: #F0FCFF; 
            box-shadow: 0 0 8px rgba(39, 188, 253, 0.4);
        }
        .cerberus-role { color: var(--color-step-border); font-weight: 500; margin-bottom: 5px; font-size: 0.9em;}
        .gherkin-ref { font-style: italic; color: #555; margin-top: 8px; font-size: 0.9em; border-top: 1px dashed #eee; padding-top: 5px; font-weight: 300;}

        /* Style des actions/contr√¥les cliquables - √âDITION */
        .action-list { list-style: none; padding: 0; }
        .action-item {
            padding: 10px 15px; 
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08); 
            font-weight: 300;
            line-height: 1.4;
            font-size: 0.95em;
            border: 1px solid #f0f0f0;
            border-left-width: 5px;
            background-color: #fff; /* Fond Blanc */
        }
        .action-item:hover {
            box-shadow: 0 0 8px rgba(44, 123, 229, 0.3); 
        }

        /* Action */
        .action-item-action { border-left-color: var(--color-action-border); } 
        .action-keyword-action { color: var(--color-action-border); font-weight: 600; } 
        /* Contr√¥le */
        .action-item-control { border-left-color: var(--color-control-border); } 
        .action-keyword-control { color: var(--color-control-border); font-weight: 600; } 

        .action-item ul {
            list-style: none; 
            padding-left: 0;
            margin: 8px 0 0 0;
            font-size: 0.8em;
            line-height: 1.5;
            border-top: 1px dotted #ccc;
            padding-top: 5px;
            list-style: disc; 
            padding-left: 15px;
            color: #777;
        }
        .action-item ul li { margin-bottom: 3px; }

        /* Bloc de code technique */
        .code-block-container {
            border: 1px solid #444; 
            background-color: #272822; 
            color: #F8F8F2;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .cerberus-blocked { 
            width: 100%; 
            height: 100%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            background-color: #FBEFEF; 
            border: 3px dashed #D32F2F; 
            border-radius: 4px; 
            flex-direction: column; 
            padding: 20px; 
        }
        
        /* -- MODE EX√âCUTION D√âTAILL√âE (Steps + Actions Color√©es) -- */
        /* La bordure verticale est conserv√©e via les classes de base (.step-block, .action-item-...) */
        
        /* Succ√®s (OK) - Bordure Type + Fond Vert Clair */
        .step-block.RUN-OK, .action-item.RUN-OK { 
            background-color: rgb(224, 250, 239) !important; /* Vert tr√®s clair */
            border: 1px solid #d0d0d0; /* Bordure fine neutre */
            box-shadow: 0 0 5px rgba(39, 188, 253, 0.1); 
            cursor: default;
        }
        /* √âchec (KO - Bug Dev) - Bordure Type + Fond Rose Clair */
        .step-block.RUN-KO, .action-item.RUN-KO { 
            background-color: rgb(252, 231, 235) !important; /* Rose tr√®s clair */
            border: 1px solid #d0d0d0;
            box-shadow: 0 0 5px rgba(244, 67, 54, 0.2); 
            cursor: default;
        }
        /* √âchec d'automatisation (FA) - Bordure Type + Fond Orange Clair */
        .step-block.RUN-FA, .action-item.RUN-FA { 
            background-color: rgb(254, 240, 232) !important; /* Jaune/Orange tr√®s clair */
            border: 1px solid #d0d0d0;
            box-shadow: 0 0 5px rgba(255, 152, 0, 0.2);
            cursor: default;
        }
        
        /* Couleurs du texte en mode RUN (pour lisibilit√©) */
        .step-block.RUN-OK .cerberus-role, .action-item.RUN-OK .action-keyword-action, .action-item.RUN-OK .action-keyword-control { color: #388E3C; }
        .step-block.RUN-KO .cerberus-role, .action-item.RUN-KO .action-keyword-action, .action-item.RUN-KO .action-keyword-control { color: #D32F2F; }
        .step-block.RUN-FA .cerberus-role, .action-item.RUN-FA .action-keyword-action, .action-item.RUN-FA .action-keyword-control { color: #E65100; }

        /* Correction des couleurs des mots-cl√©s qui sont surcharg√©es en mode RUN-OK/KO/FA si elles sont dans la liste d'actions */
        /* Je les ai remont√© pour qu'elles aient une meilleure priorit√© */


        /* -- MODE EX√âCUTION LOG (Panneau de Droite) -- */
        .cerberus-log-view { 
            display: flex; 
            height: 65vh; 
            min-height: 500px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 15px;
            box-shadow: 0 0 15px rgba(39, 188, 253, 0.1); 
        }
        
        /* Panneau de Gauche (Synth√®se/Rapport) */
        .run-summary-panel {
            width: 35%;
            padding: 25px; 
            background-color: #F8FDFF; /* Fond clair */
            border-right: 1px solid #FFEDD5; 
            display: flex;
            flex-direction: column;
        }
        .run-summary-panel h4 { 
            font-weight: 500;
            color: var(--color-action-border); 
            border-bottom: 2px solid #BBDEFB; 
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.4em;
        }

        .summary-banner {
            padding: 18px; 
            margin-bottom: 25px;
            border-radius: 8px; 
            color: #fff;
            font-weight: 700; 
            text-align: center;
            font-size: 1.2em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .summary-banner.OK { background-color: #4CAF50; }
        .summary-banner.KO { background-color: #F44336; }
        .summary-banner.FA { background-color: #FF9800; }

        .report-details { margin-top: 15px; font-size: 0.95em; line-height: 1.6;} 
        .report-details p { margin: 10px 0; }
        .report-details strong { font-weight: 600; color: #333; }
        
        .report-proof-link {
            display: block;
            margin-top: auto; 
            padding: 12px;
            background-color: #c9e6ff; 
            border: 1px solid var(--color-action-border);
            text-align: center;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            font-weight: 600;
            transition: all 0.2s;
        }
        .report-proof-link:hover { background-color: var(--color-action-border); color: white; }


        /* Panneau de Droite (Journal d'Ex√©cution) */
        .run-log-panel {
            width: 65%;
            background-color: #fff;
            padding: 15px; 
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.8em; 
        }
        .run-log-panel h4 { margin-top: 0; color: #555; border-bottom: 1px solid #eee; padding-bottom: 10px;}

        .log-entry {
            display: block;
            padding: 4px 8px; 
            margin-bottom: 3px; 
            white-space: pre-wrap;
            line-height: 1.4;
            border-left: 4px solid transparent; 
            background-color: #fafafa;
        }

        /* Couleurs du statut des logs */
        .log-entry.INFO { background-color: #fcfcfc; color: #777; border-left-color: #ccc; }
        .log-entry.STEP { background-color: #E3F2FD; border-left-color: var(--color-step-border); color: #1565C0; font-weight: 600; } /* Couleur Step */
        .log-entry.OK { background-color: #E8FDE8; color: #388E3C; border-left-color: #4CAF50; } 
        .log-entry.KO { background-color: #FFEBEE; color: #D32F2F; border-left-color: #F44336; font-weight: 600; } 
        .log-entry.FA { background-color: #FFF3E0; color: #E65100; border-left-color: #FF9800; font-weight: 600; } 
        /* Contr√¥les */
        .log-entry.CONTROL_OK { background-color: #DCEEFD; border-left-color: var(--color-control-border); color: var(--color-control-border); } /* Couleur Contr√¥le */
        .log-entry.CONTROL_KO { background-color: #FFE0B2; border-left-color: #FF9800; color: #E65100; font-weight: 600; } 

    </style>
</head>
<body>

<div class="header">
    <h1>‚ú® QualiSphere</h1>
    <p>US Align√©es, Tests Automatis√©s. La Tra√ßabilit√© de l'Exigence.</p>
</div>

<div class="us-selector-header">
    <h4>Contexte de la User Story</h4>
    <div class="us-tabs-container">
        <div class="us-tab active" data-us="us123">
            <div class="us-id"></div>
            <div class="us-title"></div>
            <div class="us-type">D√©monstration du cycle de vie agile</div>
        </div>
    </div>
</div>

<div class="tool-section" id="us-statuses-section">
    <h3>1. Statuts US Agile (Cycle de Vie) üîÑ <span style="font-size: 0.6em; color: #6A1B9A;">(Cliquez pour changer la vue)</span></h3>
    <ul class="us-status-list">
        <li class="us-status-item status-Refining" id="status-Refining">Refining (Comprendre)</li>
        <li class="us-status-item status-ReadyToDev" id="status-ReadyToDev">Ready to Dev (Pr√©parer)</li>
        <li class="us-status-item status-InDev" id="status-InDev">In Dev (Affiner)</li>
        <li class="us-status-item status-InTest" id="status-InTest">In Test (Ex√©cuter)</li>
        <li class="us-status-item status-Done" id="status-Done">Done (Valider qualit√©)</li>
    </ul>

    <div class="qa-info-block qa-hidden" id="status-info-card" style="display:none;">
        <p><strong style="font-size: 1.1em;">Statut Agile et Action QA :</strong> <span id="status-message-qa"></span></p>
        <p id="status-action-qa" style="margin-top: 5px;"></p>
    </div>
</div>


<div class="tool-section" id="azure-devops-main-section">
    <h3>2. Azure DevOps : L'Exigence (Input PO) & Analyse QA</h3>
    
    <div class="us-title-section">
        <h5>Titre US (Valeur m√©tier)</h5>
        
        <div class="us-title-content-block">
            üìñ USER STORY <span id="azdo-us-id"></span> : <span id="azdo-title-content-h4"></span>
        </div>
        
        <a class="qa-toggle-link" data-qa-target="qa-title-analysis">Afficher l'Analyse QA / Impact Test sur le Titre</a>
        
        <div class="qa-info-block standard qa-hidden" id="qa-title-analysis" style="display:none;">
            <h5>Analyse du Titre (Valeur M√©tier)</h5>
            <p>Le titre doit √™tre **clair** et centr√© sur la **valeur m√©tier** (le pourquoi) pour valider l'alignement PO/QA. <br/>
            **R√¥le PO :** R√©diger un titre concis.
            </p>
        </div>
    </div>

    <div class="us-description-section">
        <h5>Description (Fonctionnelle)</h5>
        
        <div class="us-desc-box">
            <p id="azdo-desc-content"></p>
        </div>
        
        <a class="qa-toggle-link" data-qa-target="qa-desc-analysis">Afficher l'Analyse QA / Impact Test sur la Description</a>
        
        <div class="qa-info-block standard qa-hidden" id="qa-desc-analysis" style="display:none;">
            <h5>Analyse de la Description (P√©rim√®tre)</h5>
            <p>La description d√©finit le **p√©rim√®tre fonctionnel** (le "QUOI"). Sa clart√© est essentielle pour √©viter les tests hors-sujet. <br/>
            **R√¥le PO :** D√©finir le besoin (En tant que/Je veux/Afin de).
            </p>
        </div>
    </div>

    <div class="ca-section">
        <h5>Crit√®res d'Acceptation (Testabilit√© PO/QA)</h5>
        
        <div id="azdo-ca-content">
            </div>

        <a class="qa-toggle-link" data-qa-target="qa-ca-analysis">Afficher l'Analyse QA / Impact Test sur les Crit√®res d'Acceptation</a>
        
        <div class="qa-info-block standard qa-hidden" id="qa-ca-analysis" style="display:none;">
            <h5>Analyse des Crit√®res d'Acceptation (Mesurabilit√©)</h5>
            <p>Les CAs (format Gherkin) sont le contrat PO/QA. Ils traduisent le besoin en sc√©narios **mesurables**.</p>
            <ul>
                <li>**R√¥le QA :** S'assurer que le "ALORS" est **quantifiable** et complet (ex: "en moins de 3 secondes", "le message X est affich√©").</li>
                <li>**R√¥le PO :** Valider les CAs comme contrat de recette.</li>
            </ul>
        </div>
    </div>
</div>


<div class="tool-section cerberus-section">
    <h3>3. Cerberus : D√©coupage du Test (Le "Comment" du QA)</h3>

    <div class="cerberus-properties-box">
        <h4>Param√®tres du Test Case (Propri√©t√©s)</h4>
        <div id="cerberus-properties-content">
            </div>
    </div>

    <div class="cerberus-view-wrapper">
        <p id="scenario-name"><strong>Sc√©nario Test√© :</strong></p>
        
        <div class="cerberus-editor-run" id="cerberus-editor-run">
            </div>
        
        <div class="cerberus-log-view" id="cerberus-log-view" style="display:none;">
            <div class="run-summary-panel">
                <h4>Synth√®se du Rapport d'Ex√©cution</h4>
                <div class="summary-banner" id="run-summary-banner"></div>
                <div class="report-details" id="run-report-details"></div>
                <a href="#" class="report-proof-link">D√©tail des Preuves & Captures d'√âcran (Report ID)</a>
            </div>
            <div class="run-log-panel" id="run-log-panel">
                </div>
        </div>
    </div>

    <div class="code-block-container" id="technical-code-container" style="display:none;">
        <pre id="technical-code"></pre>
    </div>
</div>

<script>
    const codeSnippets = {
        // Actions
        "Open Application": `<span class="variable">driver</span> = <span class="function">selenium.webdriver</span>.<span class="variable">Chrome</span>(<span class="variable">options</span>)`,
        "Open Url": `<span class="variable">driver</span>.<span class="function">get</span>(<span class="string">"https://baseurl/store/home"</span>)`,
        "Click": `<span class="variable">driver</span>.<span class="function">find_element</span>(<span class="variable">By</span>.<span class="variable">ID</span>, <span class="string">"importBtn"</span>).<span class="function">click</span>()`,
        "Feed field": `
<span class="comment"># Utilisation de la variable g√©n√©r√©e (Propri√©t√© du Test Case)</span>
<span class="variable">user_email</span> = <span class="string">"[[RandomEmail]]"</span>
<span class="variable">driver</span>.<span class="function">find_element</span>(<span class="variable">By</span>.<span class="variable">ID</span>, <span class="string">"emailInput"</span>).<span class="function">send_keys</span>(<span class="variable">user_email</span>)
        `,
        "Upload File to Robot": `<span class="comment"># Simuler le t√©l√©chargement du fichier de test via l'environnement du robot</span>
<span class="variable">driver</span>.<span class="function">find_element</span>(<span class="variable">By</span>.<span class="variable">NAME</span>, <span class="string">"file-input"</span>).<span class="function">send_keys</span>(<span class="string">"data/150_lines_valid.csv"</span>)`,
        "Call Service": `
<span class="variable">response</span> = <span class="function">http_client</span>.<span class="function">get</span>(<span class="string">"/api/products/123"</span>, <span class="variable">headers</span>={<span class="string">"X-API-KEY"</span>: <span class="string">"[[API_KEY]]"</span>})
<span class="comment"># L'objet 'response' est stock√© pour l'√©tape de contr√¥le suivante.</span>
        `,
        "Start Timer": `
<span class="comment"># Action Syst√®me (n√©cessaire √† Numeric Comparison)</span>
<span class="variable">timer</span> = <span class="function">time</span>.<span class="function">time</span>() 
        `,
        "Execute Javascript Command": `<span class="comment"># Ex√©cuter un script JS pour redimensionner la fen√™tre du navigateur (mobile/desktop)</span>
<span class="variable">driver</span>.<span class="function">execute_script</span>(<span class="string">"window.resize(375, 812)"</span>)`,

        // Contr√¥les
        "Verify Text in Page": `<span class="keyword">assert</span> <span class="string">"Importation r√©ussie"</span> <span class="keyword">in</span> <span class="variable">driver</span>.<span class="function">page_source</span>`,
        "Numeric Comparison": `
<span class="comment"># Le contr√¥le utilise le Timer ID et v√©rifie que la valeur est <= 3.0</span>
<span class="keyword">assert</span> (<span class="function">time</span>.<span class="function">time</span>() - <span class="variable">timer</span>) <span class="keyword">&lt;=</span> <span class="variable">3.0</span>, <span class="string">"Perf Failure: > 3s"</span>
        `,
        "Verify Element": `<span class="keyword">assert</span> <span class="variable">driver</span>.<span class="function">find_element</span>(<span class="variable">By</span>.<span class="variable">CSS_SELECTOR</span>, <span class="string">".success-message"</span>).<span class="function">is_displayed</span>()`,
        "Verify JSON": `
<span class="comment"># Contr√¥le du code de statut HTTP et de la structure JSON (Simule "Verify Json Format")</span>
<span class="keyword">assert</span> <span class="variable">response</span>.<span class="function">status_code</span> == <span class="variable">200</span>
<span class="keyword">assert</span> <span class="variable">response</span>.<span class="function">json</span>()[<span class="string">'product_id'</span>] == <span class="string">"123"</span>
<span class="keyword">assert</span> <span class="variable">response</span>.<span class="function">json</span>()[<span class="string">'status'</span>] == <span class="string">"active"</span>
        `,
        "Take a Screenshot": `<span class="variable">driver</span>.<span class="function">save_screenshot</span>(<span class="string">"proofs/menu_mobile.png"</span>)`,
        "Calculate Property": `<span class="variable">tc_variable</span>[<span class="string">'AuthorizationHeader'</span>] = <span class="string">"Bearer "</span> + <span class="variable">API_KEY</span>`,
    };

    // Donn√©es de la User Story UNIQUE
    const baseScenario = {
        id: "57767", 
        title: "Importation rapide de commandes volumineuses via CSV",
        desc: "<strong>En tant que</strong> Alice (Responsable Achat Strat√©gique), <strong>je veux</strong> pouvoir importer une liste d'articles depuis un fichier CSV, <strong>afin de</strong> passer rapidement des commandes volumineuses sans erreurs de saisie.",
        cas: `<div class="ca-gherkin"><p><strong>CA 1 (Validit√© & Performance) :</strong></p><ul><li>**√âTANT DONN√â** que je suis connect√©e en tant qu'Alice et que j'ai un CSV de 150 lignes valides,</li><li>**QUAND** j'importe ce fichier via la fonctionnalit√© d√©di√©e,</li><li>**ALORS** les 150 articles sont ajout√©s au panier **en moins de 3 secondes** (V√©rification QA Technique) et le message "Importation r√©ussie" s'affiche (V√©rification PO/QA Fonctionnel).</li></ul><div style="margin-top: 15px; border-left: 5px solid red; padding-left: 10px; font-weight: 500;">Note du PO/QA : Le Crit√®re d'Acceptation est **mesurable** car il sp√©cifie une dur√©e (< 3 secondes). C'est le standard "Ready to Dev".</div></div>`,
        scenarioName: "TC-101 (US-57767) : Import CSV - Nominal & Performance (< 3s)",
        properties: [
            { name: "Application", value: "E-Commerce V2 (Web)" },
            { name: "Browser", value: "Chrome" },
            { name: "Global Timeout", value: "90 seconds" }
        ],
        steps: [
            { role: "QA (Pr√©paration - √âTANT DONN√â)", gherkin: "Pr√©paration du contexte utilisateur et de la page d'importation.", status: "OK", actions: [ // Statut OK
                { type: "ACTION", keyword: "Open Application", desc: "Initialiser une session de navigateur.", params: [{ name: "Browser", value: "Chrome" }], status: "OK" }, 
                { type: "ACTION", keyword: "Open Url", desc: "Naviguer vers l'interface d'importation.", params: [{ name: "URL", value: "/orders/import/" }], status: "OK" }
            ] },
            { role: "QA (Action - QUAND)", gherkin: "D√©clenchement de l'importation du fichier CSV.", status: "KO", actions: [ // Statut KO
                { type: "ACTION", keyword: "Start Timer", desc: "D√©clenchement du chronom√®tre (Action Syst√®me/Interne, n√©cessaire au Control de temps).", params: [{ name: "Timer ID", value: "load_csv" }], status: "OK" }, 
                { type: "ACTION", keyword: "Click", desc: "Cliquer sur le bouton 'Importer CSV'.", params: [{ name: "Object", value: "ImportButton" }, { name: "Locator", value: "ID=importBtn" }], status: "OK" }, 
                { type: "ACTION", keyword: "Upload File to Robot", desc: "S√©lectionner le fichier de donn√©es (150 lignes) sur le syst√®me du Robot.", params: [{ name: "Input Object", value: "FileInput" }, { name: "File Name", value: "150_lines_valid.csv" }], status: "KO" }
            ] },
            { role: "QA (V√©rification - ALORS)", gherkin: "V√©rification du succ√®s fonctionnel et du crit√®re de performance.", status: "OK", actions: [ // Statut OK
                { type: "CONTROL", keyword: "Numeric Comparison", desc: "Contr√¥le automatique de l'exigence de performance : `Timer <= 3.0`", params: [{ name: "Property 1 (Timer ID)", value: "load_csv" }, { name: "Comparator", value: "Lower or Equal" }, { name: "Property 2 (Value)", value: "3.0" }], status: "OK" }, 
                { type: "CONTROL", keyword: "Verify Text in Page", desc: "V√©rification du message fonctionnel 'Importation r√©ussie'.", params: [{ name: "Text", value: "Importation r√©ussie" }], status: "OK" }, 
                { type: "CONTROL", keyword: "Verify Text in Page", desc: "V√©rification que '150 articles' sont affich√©s (V√©rification fonctionnelle).", params: [{ name: "Text", value: "150 articles ajout√©s" }], status: "OK" }
            ] }
        ],
        executionResult: { 
            // Cas par d√©faut pour Done (Succ√®s fonctionnel)
            successOK: { 
                status: "OK", 
                date: "15/11/2025 √† 10:30", 
                reason: "Le Test Case a r√©ussi tous les Contr√¥les, incluant la validation fonctionnelle et le crit√®re de performance (< 3s). **US valid√©e Qualit√©.**",
                log: [
                    { type: "INFO", message: "D√©but de l'ex√©cution du Test Case TC-101..." },
                    { type: "STEP", message: "√âTAPE 1 (Pr√©paration du contexte utilisateur et de la page d'importation)" },
                    { type: "OK", message: "Action [Open Application] : Session Chrome initialis√©e." },
                    { type: "OK", message: "Action [Open Url] : Navigu√© vers /orders/import/." },
                    { type: "STEP", message: "√âTAPE 2 (D√©clenchement de l'importation du fichier CSV)" },
                    { type: "OK", message: "Action [Start Timer] : Chronom√®tre 'load_csv' d√©marr√©." },
                    { type: "OK", message: "Action [Click] : Bouton ImportButton cliqu√©." },
                    { type: "OK", message: "Action [Upload File to Robot] : Fichier '150_lines_valid.csv' upload√©." },
                    { type: "STEP", message: "√âTAPE 3 (V√©rification du succ√®s fonctionnel et du crit√®re de performance)" },
                    { type: "CONTROL_OK", message: "Contr√¥le [Numeric Comparison] : Temps d'ex√©cution (2.1s) est bien <= 3.0s. (Crit√®re de Performance : OK)" },
                    { type: "CONTROL_OK", message: "Contr√¥le [Verify Text in Page] : Le message 'Importation r√©ussie' est affich√©." },
                    { type: "CONTROL_OK", message: "Contr√¥le [Verify Text in Page] : Le texte '150 articles ajout√©s' est affich√©." },
                    { type: "INFO", message: "Fin de l'ex√©cution : Succ√®s. Temps total: 4.8s." }
                ],
                // Mise √† jour des status des Steps pour OK
                stepsStatus: ["OK", "OK", "OK"] 
            },
            // Cas de test pour InTest (√âchec fonctionnel / Bug Dev)
            failureKO: { 
                status: "KO", 
                date: "20/11/2025 √† 14:15", 
                reason: "√âchec du contr√¥le de Performance. Le temps d'importation a d√©pass√© les 3 secondes sp√©cifi√©es dans le CA. **Bug √† cr√©er pour l'√©quipe Dev.**",
                log: [
                    { type: "INFO", message: "D√©but de l'ex√©cution du Test Case TC-101..." },
                    { type: "STEP", message: "√âTAPE 1 (Pr√©paration du contexte utilisateur et de la page d'importation)" },
                    { type: "OK", message: "Action [Open Application] : Session Chrome initialis√©e." },
                    { type: "OK", message: "Action [Open Url] : Navigu√© vers /orders/import/." },
                    { type: "STEP", message: "√âTAPE 2 (D√©clenchement de l'importation du fichier CSV)" },
                    { type: "OK", message: "Action [Start Timer] : Chronom√®tre 'load_csv' d√©marr√©." },
                    { type: "OK", message: "Action [Click] : Bouton ImportButton cliqu√©." },
                    { type: "OK", message: "Action [Upload File to Robot] : Fichier '150_lines_valid.csv' upload√©." },
                    { type: "STEP", message: "√âTAPE 3 (V√©rification du succ√®s fonctionnel et du crit√®re de performance)" },
                    { type: "CONTROL_KO", message: "Contr√¥le [Numeric Comparison] : **√âCHEC !** Temps d'ex√©cution (4.5s) est > 3.0s. (Crit√®re de Performance : KO)" },
                    { type: "CONTROL_OK", message: "Contr√¥le [Verify Text in Page] : Le message 'Importation r√©ussie' est affich√©. (Le bug est sur la perf, pas la fonction)" },
                    { type: "INFO", message: "Fin de l'ex√©cution : √âchec sur le Crit√®re d'Acceptation de Performance. Temps total: 6.2s." }
                ],
                // Mise √† jour des status des Steps pour KO
                stepsStatus: ["OK", "OK", "KO"] 
            },
            // Cas de test alternatif pour InTest (√âchec d'automatisation / Bug QA)
            failureFA: { 
                status: "FA", 
                date: "21/11/2025 √† 09:00", 
                reason: "L'ex√©cution a √©chou√© suite √† une erreur SQL (√©tape de pr√©paration du contexte). La syntaxe de l'Action SQL est incorrecte. **Correction √† apporter par l'√©quipe QA.**",
                log: [
                    { type: "INFO", message: "D√©but de l'ex√©cution du Test Case TC-101..." },
                    { type: "STEP", message: "√âTAPE 1 (Pr√©paration du contexte utilisateur et de la page d'importation)" },
                    { type: "FA", message: "Action [Open Application] : **√âCHEC !** Erreur de connexion au DNS. (Erreur li√©e √† la config du Robot de test, pas l'application test√©e)" },
                    { type: "INFO", message: "Fin de l'ex√©cution : √âchec sur l'automatisation. Le test n'a pas pu commencer la v√©rification fonctionnelle/performance." }
                ],
                // Mise √† jour des status des Steps pour FA
                stepsStatus: ["FA", "FA", "FA"] // On met tous les suivants √† FA par convention
            }
        }
    };

    // Contenu des messages de statut QA 
    const statusMessages = {
        "Refining": {
            message: "L'exigence pr√©sente des **ambigu√Øt√©s** ou des CAs non mesurables.",
            action: "<strong>Action QA/Cerberus :</strong> **BLOCAGE** de l'automatisation. Le PO doit clarifier l'exigence pour passer √† **Ready to Dev** (DoR non valid√©e)."
        },
        "ReadyToDev": {
            message: "L'exigence est stable et compl√®te. **Feu vert pour la conception du test** (DoR valid√©e).",
            action: "<strong>Action QA/Cerberus :</strong> Cr√©er la **structure** du Test Case (Nom, Propri√©t√©s, √âtapes Gherkin) dans Cerberus. Le d√©veloppement des Actions et Contr√¥les est en attente."
        },
        "InDev": {
            message: "L'exigence est en d√©veloppement. Le Test Case est en cours d'**automatisation d√©taill√©e**.",
            action: "<strong>Action QA/Cerberus :</strong> Renseigner les **Actions/Contr√¥les** (√©tapes atomiques) dans Cerberus et valider avec le d√©veloppeur."
        },
        "InTest": {
            message: "Le code est d√©ploy√© en environnement de test. Le Test Case est **ex√©cut√©** automatiquement.",
            action: "<strong>Action QA/Cerberus :</strong> Analyser le **Rapport d'Ex√©cution** et les r√©sultats. Le statut sera mis √† jour apr√®s la validation. (Simule **KO** ou **FA**)"
        },
        "Done": {
            message: "L'exigence est termin√©e et valid√©e. Le Test Case est **finalis√©** et int√©gr√© √† la non-r√©gression.",
            action: "<strong>Action QA/Cerberus :</strong> Le Test Case est d√©sormais un actif de l'entreprise. S'assurer qu'il est inclus dans le **Smoke Test** ou la R√©gression Nocturne. (Simule **OK**)"
        }
    };


    let activeStepIndex = 0;
    let activeStatusKey = 'InTest'; 
    let activeExecutionStatus = 'KO'; 

    // La fonction principale de rendu, pilot√©e par le statut
    function renderQualiSphere(statusKey, executionStatus = 'OK') {
        activeStatusKey = statusKey;
        activeExecutionStatus = executionStatus;
        const scenario = baseScenario;

        // 1. Mettre √† jour la section STATUT (Bloc 1)
        updateQaBlocks(statusKey);
        
        // 2. Mettre √† jour la section AZDO (Bloc 2 - US statique)
        renderAzdoContent(scenario);
        
        // 3. Mettre √† jour la section CERBERUS (Bloc 3)
        const cerberusEditorRun = document.getElementById('cerberus-editor-run');
        const cerberusLogView = document.getElementById('cerberus-log-view');
        
        // Nettoyage et Affichage/Masquage des vues
        cerberusEditorRun.innerHTML = ''; // Nettoyer le contenu pour √©viter les doublons/m√©langes
        cerberusEditorRun.style.display = 'flex';
        cerberusLogView.style.display = 'none'; 
        
        // Cacher le code technique au changement de statut
        document.getElementById('technical-code-container').style.display = 'none';
        document.getElementById('technical-code-container').style.opacity = '0';

        document.getElementById('scenario-name').innerHTML = `<strong>Sc√©nario Test√© :</strong> <span style="color: #6A1B9A;">${scenario.scenarioName}</span>`;

        // Affichage des Propri√©t√©s (statiques)
        const propertiesContent = document.getElementById('cerberus-properties-content');
        propertiesContent.innerHTML = '';
        if (scenario.properties && scenario.properties.length > 0) {
            scenario.properties.forEach(prop => {
                const propItem = document.createElement('span');
                propItem.className = 'property-item';
                propItem.innerHTML = `<strong>${prop.name} :</strong> ${prop.value}`;
                propertiesContent.appendChild(propItem);
            });
        }
        
        // Logique de BLOCAGE/R√âSULTAT DYNAMIQUE
        if (statusKey === 'Refining') {
            cerberusEditorRun.style.display = 'flex';
            const blockedDiv = document.createElement('div');
            blockedDiv.className = 'cerberus-blocked';
            blockedDiv.style.minHeight = '40vh'; 
            blockedDiv.innerHTML = `
                <h5>AUTOMATISATION SUSPENDUE üõë : US en REFINING !</h5>
                <p>Le QA ne peut pas cr√©er de tests stables car l'exigence (Crit√®res d'Acceptation) est encore en cours d'√©criture ou de validation. <br/>
                **C'est le r√¥le de QualiSphere de bloquer l'automatisation √† ce stade.**</p>
                <p>L'outil Cerberus est en attente du statut **Ready to Dev** (voir l'Analyse QA ci-dessus).</p>
            `;
            cerberusEditorRun.innerHTML = '';
            cerberusEditorRun.appendChild(blockedDiv);
            return; 
        }
        
        // Affichage du MODE EX√âCUTION (Steps/Actions color√©es + Log)
        if (statusKey === 'InTest' || statusKey === 'Done') {
            cerberusLogView.style.display = 'flex'; // Affiche le panneau de Log
            // L'√©diteur reste visible pour la vue d√©taill√©e (Steps/Actions)
            renderRunLogView(scenario, executionStatus);
            return;
        }


        // Affichage du MODE √âDITION (ReadyToDev / InDev - Bordure Type + Fond Blanc)
        cerberusEditorRun.style.display = 'flex';
        
        const stepsContainer = document.createElement('div');
        const actionsContainer = document.createElement('div');
        
        // Nettoyage pour le mode √©dition
        cerberusEditorRun.innerHTML = ''; 

        cerberusEditorRun.appendChild(stepsContainer);
        cerberusEditorRun.appendChild(actionsContainer);
        
        stepsContainer.className = 'steps-container';
        actionsContainer.className = 'actions-container';

        
        // Construction des Steps Gherkin (Mode √âdition)
        stepsContainer.innerHTML = '<h4>√âtapes Fonctionnelles (Steps Gherkin)</h4>';
        scenario.steps.forEach((step, index) => {
            const stepBlock = document.createElement('div');
            // La classe "active" ajoute une bordure compl√®te pour le focus, sinon la bordure verticale (step-block) est simple
            stepBlock.className = `step-block ${index === activeStepIndex ? 'active' : ''}`;
            stepBlock.setAttribute('data-step-index', index);
            stepBlock.addEventListener('click', () => {
                activeStepIndex = index;
                renderQualiSphere(activeStatusKey, activeExecutionStatus);
            });
            
            stepBlock.innerHTML = `
                <span class="cerberus-role">${step.role}</span>
                <strong>Step ${index + 1}</strong>
                <div class="gherkin-ref">${step.gherkin}</div>
            `;
            stepsContainer.appendChild(stepBlock);
        });
        
        // Construction des Actions/Contr√¥les (Mode √âdition)
        actionsContainer.innerHTML = '<h4>Actions (Bleu) & Contr√¥les (Vert)</h4>';

        if (statusKey === 'ReadyToDev') {
            actionsContainer.innerHTML += `
                <div class="pending-actions-message">
                    <h5 style="margin-top: 0; font-weight: 500;">ACTIONS/CONTR√îLES EN ATTENTE ‚è≥</h5>
                    <p style="font-style: italic; color: #555; margin-bottom: 0;">
                        Le statut **Ready to Dev** signifie que le QA a d√©fini la structure du test (Steps Gherkin). 
                        L'impl√©mentation des commandes techniques (Actions/Contr√¥les) est le travail de la phase **IN DEV** (d√©veloppement par le QA de l'automatisation).
                    </p>
                </div>
            `;
        } else { // InDev
            const infoP = document.createElement('p');
            infoP.style.fontStyle = 'italic';
            infoP.style.color = '#777';
            infoP.style.fontWeight = '300';
            infoP.innerHTML = "Le QA traduit les √©tapes Gherkin en commandes Cerberus (**Actions** et **Contr√¥les**) pour automatiser le sc√©nario. **Cliquez** sur une commande pour voir le code source.";
            actionsContainer.appendChild(infoP);

            const actionList = document.createElement('ul');
            actionList.className = 'action-list';

            const activeStep = scenario.steps[activeStepIndex];

            activeStep.actions.forEach((action) => {
                const isControl = action.type === 'CONTROL';
                const itemClass = isControl ? 'action-item-control' : 'action-item-action';
                const keywordClass = isControl ? 'action-keyword-control' : 'action-keyword-action';
                const icon = isControl ? 'Contr√¥le :' : 'Action :';
                
                const actionItem = document.createElement('li');
                actionItem.className = `action-item ${itemClass}`;
                actionItem.setAttribute('data-keyword', action.keyword);
                actionItem.addEventListener('click', function() {
                    displayTechnicalCode(this.getAttribute('data-keyword'));
                });

                let paramsHtml = '';
                if (action.params && action.params.length > 0) {
                    paramsHtml = '<ul>';
                    action.params.forEach(param => {
                        const paramColor = isControl ? 'var(--color-control-border)' : 'var(--color-action-border)';
                        paramsHtml += `<li><strong style="color: ${paramColor};">${param.name}:</strong> ${param.value}</li>`;
                    });
                    paramsHtml += '</ul>';
                }

                actionItem.innerHTML = `
                    <span class="${keywordClass}">${icon} ${action.keyword}</span>
                    <p>${action.desc}</p>
                    ${paramsHtml} 
                `;
                actionList.appendChild(actionItem);
            });
            actionsContainer.appendChild(actionList);
        }
    }
    
    // NOUVELLE FONCTION: G√®re l'affichage des r√©sultats d'ex√©cution (InTest et Done)
    function renderRunLogView(scenario, executionStatus) {
        let resultData;
        if (executionStatus === 'OK') {
            resultData = scenario.executionResult.successOK;
        } else if (executionStatus === 'KO') {
             resultData = scenario.executionResult.failureKO;
        } else {
             resultData = scenario.executionResult.failureFA;
        }
        
        const summaryBanner = document.getElementById('run-summary-banner');
        const reportDetails = document.getElementById('run-report-details');
        const logPanel = document.getElementById('run-log-panel');
        
        // 1. Panneau de Gauche (Rapport)
        summaryBanner.className = `summary-banner ${resultData.status}`;
        summaryBanner.textContent = `R√âSULTAT GLOBAL : ${resultData.status}`;
        
        reportDetails.innerHTML = `
            <p><strong>Rapport ID :</strong> ${scenario.id}-${resultData.status}-20251120</p>
            <p><strong>Statut :</strong> ${resultData.reason}</p>
            <p><strong>Ex√©cut√© le :</strong> ${resultData.date}</p>
            <p><strong>Auteur :</strong> Robot Selenium/API (par Alice A.)</p>
        `;
        
        // 2. Panneau de Droite (Journal d'Ex√©cution)
        logPanel.innerHTML = '<h4>Journal d\'Ex√©cution D√©taill√©</h4>';
        resultData.log.forEach(log => {
            const logEntry = document.createElement('span');
            logEntry.className = `log-entry ${log.type}`;
            logEntry.textContent = log.message;
            logPanel.appendChild(logEntry);
        });

        // 3. Rendu des Steps/Actions dans la vue de Log (Simule le mode d√©taill√©)
        const cerberusEditorRun = document.getElementById('cerberus-editor-run');
        cerberusEditorRun.style.display = 'flex'; 
        
        const stepsContainer = document.createElement('div');
        const actionsContainer = document.createElement('div');
        
        cerberusEditorRun.innerHTML = ''; 

        cerberusEditorRun.appendChild(stepsContainer);
        cerberusEditorRun.appendChild(actionsContainer);
        
        stepsContainer.className = 'steps-container';
        actionsContainer.className = 'actions-container';
        
        // S√âLECTION DU STEP ACTIF (pour le panneau des actions)
        let activeStepForRun = scenario.steps[0];
        // Trouvez le dernier Step en OK ou le premier KO/FA pour le mettre en focus par d√©faut
        for (let i = 0; i < resultData.stepsStatus.length; i++) {
            if (resultData.stepsStatus[i] === 'KO' || resultData.stepsStatus[i] === 'FA') {
                activeStepForRun = scenario.steps[i];
                activeStepIndex = i; // Met √† jour l'index actif pour les actions
                break;
            } else if (resultData.stepsStatus[i] === 'OK') {
                 activeStepForRun = scenario.steps[i];
                 activeStepIndex = i; // Si tout est OK, le dernier est actif
            }
        }
        
        // Rendu des Steps (Bordure Type + Fond Statut)
        stepsContainer.innerHTML = '<h4>√âtapes Fonctionnelles (Steps Gherkin)</h4>';
        scenario.steps.forEach((step, index) => {
            const status = resultData.stepsStatus[index] || 'FA'; 
            const stepBlock = document.createElement('div');
            // RUN-OK/KO/FA g√®re uniquement le background
            stepBlock.className = `step-block RUN-${status} ${index === activeStepIndex ? 'active' : ''}`;
            
             stepBlock.addEventListener('click', () => {
                activeStepIndex = index;
                // Re-rendu de la vue Run pour mettre √† jour les actions du step s√©lectionn√©
                renderQualiSphere(activeStatusKey, activeExecutionStatus); 
            });
            
            stepBlock.innerHTML = `
                <span class="cerberus-role">Statut : ${status}</span>
                <strong>Step ${index + 1}</strong>
                <div class="gherkin-ref">${step.gherkin}</div>
            `;
            stepsContainer.appendChild(stepBlock);
        });

        // Rendu des Actions/Contr√¥les (Bordure Type + Fond Statut)
        actionsContainer.innerHTML = '<h4>Actions (Bleu) & Contr√¥les (Vert)</h4>';
        const actionList = document.createElement('ul');
        actionList.className = 'action-list';

        activeStepForRun.actions.forEach((action) => {
            const isControl = action.type === 'CONTROL';
            const status = resultData.stepsStatus[activeStepIndex] || 'FA'; // Le statut du Step actif s'applique √† ses actions
            
            const itemClass = isControl ? 'action-item-control' : 'action-item-action';
            const keywordClass = isControl ? 'action-keyword-control' : 'action-keyword-action';
            const icon = isControl ? 'Contr√¥le :' : 'Action :';
            
            const actionItem = document.createElement('li');
            // RUN-OK/KO/FA g√®re uniquement le background
            actionItem.className = `action-item RUN-${status} ${itemClass}`;
            actionItem.setAttribute('data-keyword', action.keyword);
            actionItem.style.cursor = 'default';

            let paramsHtml = '';
            if (action.params && action.params.length > 0) {
                paramsHtml = '<ul>';
                action.params.forEach(param => {
                    paramsHtml += `<li><strong>${param.name}:</strong> ${param.value}</li>`;
                });
                paramsHtml += '</ul>';
            }

            actionItem.innerHTML = `
                <span class="${keywordClass}">${icon} ${action.keyword}</span>
                <p>${action.desc}</p>
                ${paramsHtml} 
            `;
            actionList.appendChild(actionItem);
        });
        actionsContainer.appendChild(actionList);
    }


    // Fonctions de support (non modifi√©es en substance)
    function renderAzdoContent(scenario) {
        document.getElementById('azdo-us-id').textContent = scenario.id;
        document.getElementById('azdo-title-content-h4').textContent = scenario.title;
        document.getElementById('azdo-desc-content').innerHTML = scenario.desc;
        document.getElementById('azdo-ca-content').innerHTML = scenario.cas;
    }

    function updateQaBlocks(statusKey) {
        const statusInfoCard = document.getElementById('status-info-card');
        const statusMessageQA = document.getElementById('status-message-qa');
        const statusActionQA = document.getElementById('status-action-qa');
        
        document.querySelectorAll('.us-status-item').forEach(item => item.classList.remove('active-status'));
        const activeStatusPill = document.getElementById(`status-${statusKey}`);
        if(activeStatusPill) {
            activeStatusPill.classList.add('active-status');
        }

        statusInfoCard.className = 'qa-info-block'; 
        statusInfoCard.classList.add('status-' + statusKey.toLowerCase());
        
        const statusInfo = statusMessages[statusKey];
        if (statusInfo) {
            statusMessageQA.innerHTML = statusInfo.message;
            statusActionQA.innerHTML = statusInfo.action;
        }

        document.querySelectorAll('.qa-info-block.standard').forEach(block => {
            block.style.display = 'none';
        });
        
        document.querySelectorAll('.qa-toggle-link').forEach(link => {
             let label;
            if (link.dataset.qaTarget.includes('title')) {
                label = ' sur le Titre';
            } else if (link.dataset.qaTarget.includes('desc')) {
                label = ' sur la Description';
            } else if (link.dataset.qaTarget.includes('ca')) {
                label = ' sur les Crit√®res d\'Acceptation';
            } 
            link.innerHTML = 'Afficher l\'Analyse QA / Impact Test' + label; 
            link.classList.remove('qa-active');
        });
        
        statusInfoCard.style.display = 'block';
    }

    function displayTechnicalCode(keyword) {
        const codeContainer = document.getElementById('technical-code-container');
        const codeBlock = document.getElementById('technical-code');
        
        codeBlock.innerHTML = codeSnippets[keyword] || `<span class="comment"># Code non disponible pour cette commande.</span>`;
        codeContainer.style.display = 'block';

        setTimeout(() => { codeContainer.style.opacity = '1'; }, 10);
    }

    // Gestion des clics
    document.addEventListener('click', function(e) {
        // Cible A: Les liens d'analyse QA (violet)
        if (e.target.classList.contains('qa-toggle-link')) {
            e.preventDefault();
            const targetId = e.target.dataset.qaTarget;
            const targetBlock = document.getElementById(targetId);
            
            let label;
            if (e.target.dataset.qaTarget.includes('title')) {
                label = ' sur le Titre';
            } else if (e.target.dataset.qaTarget.includes('desc')) {
                label = ' sur la Description';
            } else if (e.target.dataset.qaTarget.includes('ca')) {
                label = ' sur les Crit√®res d\'Acceptation';
            } else {
                label = '';
            }

            if (targetBlock.style.display === 'none' || targetBlock.style.display === '') {
                targetBlock.style.display = 'block';
                e.target.innerHTML = 'Cacher l\'Analyse QA / Impact Test' + label; 
                e.target.classList.add('qa-active');
            } else {
                targetBlock.style.display = 'none';
                e.target.innerHTML = 'Afficher l\'Analyse QA / Impact Test' + label;
                e.target.classList.remove('qa-active');
            }
        }
        
        // Cible B: Les pilules de statut
        if (e.target.classList.contains('us-status-item')) {
             e.preventDefault();
            const newStatus = e.target.id.split('-')[1]; 
            
            if (newStatus === activeStatusKey) {
                // Si l'utilisateur clique sur le statut d√©j√† actif
                if (newStatus === 'InTest') {
                    // Pour InTest, on alterne entre KO et FA √† chaque clic pour la d√©mo
                    let nextExecutionStatus = activeExecutionStatus === 'KO' ? 'FA' : 'KO';
                    renderQualiSphere(newStatus, nextExecutionStatus);
                } else if (newStatus === 'Done') {
                     // Pour Done, on n'a qu'un √©tat (OK)
                     renderQualiSphere(newStatus, 'OK');
                } else {
                    // Pour les autres, on alterne la visibilit√© de la carte d'info
                    const targetBlock = document.getElementById('status-info-card');
                    if (targetBlock.style.display === 'block') {
                        targetBlock.style.display = 'none';
                    } else {
                        targetBlock.style.display = 'block';
                    }
                }
            } else {
                // D√©terminer l'√©tat d'ex√©cution Cerberus √† simuler pour le nouveau statut
                let simulatedExecutionStatus = 'OK'; 
                if (newStatus === 'InTest') {
                    // Initialisation en KO
                    simulatedExecutionStatus = 'KO'; 
                } else if (newStatus === 'Done') {
                     // En Done, succ√®s
                    simulatedExecutionStatus = 'OK'; 
                } else if (newStatus === 'InDev') {
                    // En InDev, on revient au mode √©dition
                    simulatedExecutionStatus = 'FA'; 
                }

                // Changer de statut
                activeStepIndex = 0; // R√©initialiser le step actif
                renderQualiSphere(newStatus, simulatedExecutionStatus); 
            }
        }
    });

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.us-tab').forEach(tab => {
            tab.querySelector('.us-title').textContent = baseScenario.title;
            tab.querySelector('.us-id').textContent = baseScenario.id;
        });
        
        // Initialiser avec un statut de d√©part (InTest - KO) pour montrer un √©chec KO
        renderQualiSphere('InTest', 'KO'); 
    });
</script>
</body>
</html>
